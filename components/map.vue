<template>
  <div id="chartdiv" ref="chartdiv"></div>
</template>

<script>
  import * as am4core from '@amcharts/amcharts4/core'
  import * as am4maps from '@amcharts/amcharts4/maps'

  export default {
    name: 'Maps',
    mounted() {
      // Create map instance
      var chart = am4core.create('chartdiv', am4maps.MapChart)
      chart.geodataSource.url = '/covid19-venezuela/geojson/venezuela.json'

      // Set map definition
      chart.geodata = chart.geodataSource.url

      // Set projection
      chart.projection = new am4maps.projections.Miller()

      // Create map polygon series
      var polygonSeries = chart.series.push(new am4maps.MapPolygonSeries())

      // Make map load polygon (like country names) data from GeoJSON
      polygonSeries.useGeodata = true

      // Configure series
      var polygonTemplate = polygonSeries.mapPolygons.template
      polygonTemplate.tooltipText = '{ESTADO}'
      polygonTemplate.fill = am4core.color('#adadad')

      // Create hover state and set alternative fill color
      var hs = polygonTemplate.states.create('hover')
      hs.properties.fill = am4core.color('#48c774')

      // Create image series
      var imageSeries = chart.series.push(new am4maps.MapImageSeries())

      var imageSeriesTemplate = imageSeries.mapImages.template
      var marker = imageSeriesTemplate.createChild(am4core.Sprite)
      marker.path =
        'm 89.858839,100.16885 a 2.8472522,2.8472522 0 0 0 -2.847395,2.84706 2.8472522,2.8472522 0 0 0 2.11642,2.74837 l -0.03445,2.08098 a 8.7685296,8.7685296 0 0 0 -3.381966,1.11451 l -1.019459,-1.5209 a 1.9401629,1.9401629 0 0 0 0.45475,-1.248 1.9401629,1.9401629 0 0 0 -1.939887,-1.94021 1.9401629,1.9401629 0 0 0 -1.940216,1.94021 1.9401629,1.9401629 0 0 0 1.940216,1.94022 1.9401629,1.9401629 0 0 0 0.518341,-0.0705 l 1.027408,1.53316 a 8.7685296,8.7685296 0 0 0 -2.181005,2.45359 l -3.017306,-1.30893 a 2.8472522,2.8472522 0 0 0 0.04935,-0.51602 2.8472522,2.8472522 0 0 0 -2.847397,-2.8474 2.8472522,2.8472522 0 0 0 -2.847064,2.8474 2.8472522,2.8472522 0 0 0 2.847064,2.84706 2.8472522,2.8472522 0 0 0 2.249234,-1.10689 l 2.961664,1.28475 a 8.7685296,8.7685296 0 0 0 -0.650163,3.2995 8.7685296,8.7685296 0 0 0 6.63e-4,0.0175 l -1.361927,0.0295 a 1.9401629,1.9401629 0 0 0 -1.889212,-1.50832 1.9401629,1.9401629 0 0 0 -1.940216,1.93988 1.9401629,1.9401629 0 0 0 1.940216,1.94022 1.9401629,1.9401629 0 0 0 1.800117,-1.21984 l 1.53846,-0.0334 a 8.7685296,8.7685296 0 0 0 0.383209,1.63683 l -0.459054,0.22191 a 0.90708883,0.90708883 0 0 0 -0.71773,-0.3534 0.90708883,0.90708883 0 0 0 -0.907179,0.90718 0.90708883,0.90708883 0 0 0 0.907179,0.90685 0.90708883,0.90708883 0 0 0 0.906849,-0.90685 0.90708883,0.90708883 0 0 0 -0.004,-0.0798 l 0.445806,-0.21529 a 8.7685296,8.7685296 0 0 0 0.473628,0.97872 l -2.303553,1.86603 a 2.8472522,2.8472522 0 0 0 -2.013413,-0.8363 2.8472522,2.8472522 0 0 0 -2.847066,2.84706 2.8472522,2.8472522 0 0 0 2.847066,2.8474 2.8472522,2.8472522 0 0 0 2.847395,-2.8474 2.8472522,2.8472522 0 0 0 -0.133807,-0.85187 l 2.342303,-1.89749 a 8.7685296,8.7685296 0 0 0 1.994866,1.86802 l -0.806822,1.59145 a 1.6881935,1.6881935 0 0 0 -0.650163,-0.13049 1.6881935,1.6881935 0 0 0 -1.688166,1.68816 1.6881935,1.6881935 0 0 0 1.688166,1.68817 1.6881935,1.6881935 0 0 0 1.688168,-1.68817 1.6881935,1.6881935 0 0 0 -0.412021,-1.10193 l 0.834313,-1.64643 a 8.7685296,8.7685296 0 0 0 2.332366,0.88731 l -0.169246,1.28177 a 1.1338611,1.1338611 0 0 0 -1.123791,1.13373 1.1338611,1.1338611 0 0 0 1.133726,1.13372 1.1338611,1.1338611 0 0 0 1.133726,-1.13372 1.1338611,1.1338611 0 0 0 -0.646187,-1.02211 l 0.171566,-1.29801 a 8.7685296,8.7685296 0 0 0 1.432143,0.12785 8.7685296,8.7685296 0 0 0 1.044962,-0.0735 l 0.632607,2.72021 a 2.8472522,2.8472522 0 0 0 -1.627225,2.56918 2.8472522,2.8472522 0 0 0 2.847395,2.8474 2.8472522,2.8472522 0 0 0 2.847397,-2.8474 2.8472522,2.8472522 0 0 0 -2.754657,-2.84276 l -0.627639,-2.69802 a 8.7685296,8.7685296 0 0 0 2.586734,-1.21685 l 0.131489,0.26264 a 1.4110273,1.4110273 0 0 0 -0.444811,1.02708 1.4110273,1.4110273 0 0 0 1.410946,1.41128 1.4110273,1.4110273 0 0 0 1.411277,-1.41128 1.4110273,1.4110273 0 0 0 -1.411277,-1.41095 1.4110273,1.4110273 0 0 0 -0.287821,0.0315 l -0.187464,-0.37493 a 8.7685296,8.7685296 0 0 0 1.323508,-1.3616 l 2.237311,1.6418 a 1.9401629,1.9401629 0 0 0 -0.11228,0.64288 1.9401629,1.9401629 0 0 0 1.940222,1.94021 1.9401629,1.9401629 0 0 0 1.94021,-1.94021 1.9401629,1.9401629 0 0 0 -1.94021,-1.94022 1.9401629,1.9401629 0 0 0 -1.142672,0.37526 l -2.274406,-1.66929 a 8.7685296,8.7685296 0 0 0 0.657778,-1.37782 l 1.123128,0.45474 a 0.80630108,0.80630108 0 0 0 0.804832,0.75582 0.80630108,0.80630108 0 0 0 0.80616,-0.80649 0.80630108,0.80630108 0 0 0 -0.80616,-0.80616 0.80630108,0.80630108 0 0 0 -0.672349,0.36168 l -1.081394,-0.43786 a 8.7685296,8.7685296 0 0 0 0.369959,-2.13662 l 1.595434,0.14838 a 1.4110273,1.4110273 0 0 0 1.35033,1.00621 1.4110273,1.4110273 0 0 0 1.41128,-1.41128 1.4110273,1.4110273 0 0 0 -1.41128,-1.41095 1.4110273,1.4110273 0 0 0 -1.3616,1.04728 l -1.57191,-0.14639 a 8.7685296,8.7685296 0 0 0 -0.800529,-3.35017 l 2.901379,-1.27151 a 2.8472522,2.8472522 0 0 0 2.11775,0.94925 2.8472522,2.8472522 0 0 0 2.84739,-2.8474 2.8472522,2.8472522 0 0 0 -2.84739,-2.84707 2.8472522,2.8472522 0 0 0 -2.84707,2.84707 2.8472522,2.8472522 0 0 0 0.0927,0.71309 l -2.91496,1.27747 a 8.7685296,8.7685296 0 0 0 -0.988326,-1.23872 l 0.354724,-0.29875 a 0.80630108,0.80630108 0 0 0 0.432227,0.12652 0.80630108,0.80630108 0 0 0 0.80616,-0.80616 0.80630108,0.80630108 0 0 0 -0.80616,-0.80649 0.80630108,0.80630108 0 0 0 -0.806491,0.80649 0.80630108,0.80630108 0 0 0 0.05299,0.2865 l -0.404406,0.34048 a 8.7685296,8.7685296 0 0 0 -1.115177,-0.88168 l 0.843587,-1.15724 a 1.4110273,1.4110273 0 0 0 0.370953,0.0513 1.4110273,1.4110273 0 0 0 1.411277,-1.41128 1.4110273,1.4110273 0 0 0 -1.411277,-1.41094 1.4110273,1.4110273 0 0 0 -1.410946,1.41094 1.4110273,1.4110273 0 0 0 0.382213,0.96448 l -0.841269,1.15426 a 8.7685296,8.7685296 0 0 0 -3.827108,-1.04264 l 0.03312,-2.00249 a 2.8472522,2.8472522 0 0 0 2.237311,-2.77751 2.8472522,2.8472522 0 0 0 -2.847066,-2.84706 z m 2.09125,9.57456 a 0.90708883,0.90708883 0 0 1 0.907177,0.90718 0.90708883,0.90708883 0 0 1 -0.907177,0.90718 0.90708883,0.90708883 0 0 1 -0.90718,-0.90718 0.90708883,0.90708883 0 0 1 0.90718,-0.90718 z m -3.981123,2.11675 a 1.4110273,1.4110273 0 0 1 1.410948,1.41095 1.4110273,1.4110273 0 0 1 -1.410948,1.41094 1.4110273,1.4110273 0 0 1 -1.410946,-1.41094 1.4110273,1.4110273 0 0 1 1.410946,-1.41095 z m 4.686595,1.41095 a 0.90708883,0.90708883 0 0 1 0.907179,0.90718 0.90708883,0.90708883 0 0 1 -0.907179,0.90684 0.90708883,0.90708883 0 0 1 -0.907179,-0.90684 0.90708883,0.90708883 0 0 1 0.907179,-0.90718 z m -8.264636,0.70547 a 0.90708883,0.90708883 0 0 1 0.907179,0.90718 0.90708883,0.90708883 0 0 1 -0.907179,0.90718 0.90708883,0.90708883 0 0 1 -0.907179,-0.90718 0.90708883,0.90708883 0 0 1 0.907179,-0.90718 z m 12.245757,0.40308 a 0.90708883,0.90708883 0 0 1 0.907179,0.90718 0.90708883,0.90708883 0 0 1 -0.907179,0.90718 0.90708883,0.90708883 0 0 1 -0.90718,-0.90718 0.90708883,0.90708883 0 0 1 0.90718,-0.90718 z m -5.744804,1.31026 a 0.90708883,0.90708883 0 0 1 0.906848,0.90718 0.90708883,0.90708883 0 0 1 -0.906848,0.90718 0.90708883,0.90708883 0 0 1 -0.907179,-0.90718 0.90708883,0.90708883 0 0 1 0.907179,-0.90718 z m 2.64569,1.41128 a 1.9905565,1.9905565 0 0 1 1.99056,1.99056 1.9905565,1.9905565 0 0 1 -1.99056,1.99056 1.9905565,1.9905565 0 0 1 -1.990561,-1.99056 1.9905565,1.9905565 0 0 1 1.990561,-1.99056 z m -5.467915,0.20137 a 0.90708883,0.90708883 0 0 1 0.907179,0.90718 0.90708883,0.90708883 0 0 1 -0.907179,0.90718 0.90708883,0.90708883 0 0 1 -0.907179,-0.90718 0.90708883,0.90708883 0 0 1 0.907179,-0.90718 z m -2.92291,1.36061 a 1.4110273,1.4110273 0 0 1 1.411277,1.41094 1.4110273,1.4110273 0 0 1 -1.411277,1.41128 1.4110273,1.4110273 0 0 1 -1.410947,-1.41128 1.4110273,1.4110273 0 0 1 1.410947,-1.41094 z m 4.8883,3.2253 a 0.90708883,0.90708883 0 0 1 0.907179,0.90718 0.90708883,0.90708883 0 0 1 -0.907179,0.90685 0.90708883,0.90708883 0 0 1 -0.907179,-0.90685 0.90708883,0.90708883 0 0 1 0.907179,-0.90718 z m 2.948082,0.35274 a 0.57952883,0.57952883 0 0 1 0.579615,0.57961 0.57952883,0.57952883 0 0 1 -0.579615,0.57962 0.57952883,0.57952883 0 0 1 -0.579614,-0.57962 0.57952883,0.57952883 0 0 1 0.579614,-0.57961 z'
      marker.width = 22
      marker.height = 22
      marker.nonScaling = true
      marker.tooltipText = '{title}'
      marker.horizontalCenter = 'middle'
      marker.verticalCenter = 'middle'
      marker.propertyFields.fill = 'color'

      //console.log(polygonSeries)

      // Set property fields
      imageSeriesTemplate.propertyFields.latitude = 'latitude'
      imageSeriesTemplate.propertyFields.longitude = 'longitude'

      // Caracas (8), Miranda (13), La Guaira (5), Aragua (2), Anzoátegui (2), Mérida (1), Cojedes (1) y Apure (1).
      imageSeries.data = [
        {
          latitude: 10.4880104,
          longitude: -66.9791885,
          title: 'Caracas 8',
          color: am4core.color('#f14668')
        },
        {
          latitude: 10.2959803,
          longitude: -66.3534698,
          title: 'Miranda 13',
          color: am4core.color('#f14668')
        },
        {
          latitude: 10.5880104,
          longitude: -66.6791885,
          title: 'La Guaira 5',
          color: am4core.color('#f14668')
        },
        {
          latitude: 10.2353497,
          longitude: -67.3911331,
          title: 'Aragua 2',
          color: am4core.color('#f14668')
        },
        {
          latitude: 9.7362495,
          longitude: -64.6861801,
          title: 'Anzoátegui 2',
          color: am4core.color('#f14668')
        },
        {
          latitude: 8.5897198,
          longitude: -71.1561127,
          title: 'Mérida 1',
          color: am4core.color('#f14668')
        },
        {
          latitude: 9.6612396,
          longitude: -68.5826797,
          title: 'Cojedes 1',
          color: am4core.color('#f14668')
        },
        {
          latitude: 7.5878198,
          longitude: -67.4723587,
          title: 'Apure 1',
          color: am4core.color('#f14668')
        }
      ]

      // Add zoom control
      chart.zoomControl = new am4maps.ZoomControl()
    },

    beforeDestroy() {
      if (this.chart) {
        this.chart.dispose()
      }
    }
  }
</script>

<style>
  #chartdiv {
    width: 80%;
    height: 98vh;
    margin: 0 auto;
  }
</style>
